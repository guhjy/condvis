<!doctype html>
<html>
  <head>

    <link rel="apple-touch-icon" sizes="57x57" href="favicon/apple-touch-icon-57x57.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="60x60" href="favicon/apple-touch-icon-60x60.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="72x72" href="favicon/apple-touch-icon-72x72.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="76x76" href="favicon/apple-touch-icon-76x76.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="114x114" href="favicon/apple-touch-icon-114x114.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="120x120" href="favicon/apple-touch-icon-120x120.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="144x144" href="favicon/apple-touch-icon-144x144.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="152x152" href="favicon/apple-touch-icon-152x152.png?v=8jjxpnJQBL">
    <link rel="apple-touch-icon" sizes="180x180" href="favicon/apple-touch-icon-180x180.png?v=8jjxpnJQBL">
    <link rel="icon" type="image/png" href="favicon/favicon-32x32.png?v=8jjxpnJQBL" sizes="32x32">
    <link rel="icon" type="image/png" href="favicon/favicon-194x194.png?v=8jjxpnJQBL" sizes="194x194">
    <link rel="icon" type="image/png" href="favicon/favicon-96x96.png?v=8jjxpnJQBL" sizes="96x96">
    <link rel="icon" type="image/png" href="favicon/android-chrome-192x192.png?v=8jjxpnJQBL" sizes="192x192">
    <link rel="icon" type="image/png" href="favicon/favicon-16x16.png?v=8jjxpnJQBL" sizes="16x16">
    <link rel="manifest" href="favicon/manifest.json?v=8jjxpnJQBL">
    <link rel="mask-icon" href="favicon/safari-pinned-tab.svg?v=8jjxpnJQBL" color="#5bbad5">
    <link rel="shortcut icon" href="favicon/favicon.ico?v=8jjxpnJQBL">
    <meta name="apple-mobile-web-app-title" content="condvis">
    <meta name="application-name" content="condvis">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="msapplication-TileImage" content="/favicon/mstile-144x144.png?v=8jjxpnJQBL">
    <meta name="msapplication-config" content="/favicon/browserconfig.xml?v=8jjxpnJQBL">
    <meta name="theme-color" content="#ffffff">

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>condvis</title>

    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/github-light.css">
    <meta name="viewport" content="width=device-width">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>condvis</h1>
        <p>Conditional Visualisation for <br>Statistical Models</p>

        <p class="view">
          <a href="https://cran.r-project.org/web/packages/condvis">
            View on CRAN
          </a><br>
          <a href="https://github.com/markajoc/condvis">
            View on GitHub
          </a>
        </p>

        <ul>
          <li><a href="https://github.com/markajoc/condvis/zipball/master"
            >Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/markajoc/condvis/tarball/master"
            >Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/markajoc/condvis">View On
            <strong>GitHub</strong></a></li>
        </ul>
        <hr>
        <p><a href = "http://markajoc.github.io/condvis/">Home page</a></p>
        <p><a href = "http://markajoc.github.io/condvis/gettingstarted.html"
          >Getting started</a></p>
        <p><a href = "http://markajoc.github.io/condvis/using.html"
          >Using condvis</a></p>
        <p><a href = "http://markajoc.github.io/condvis/examples.html"
          >Examples</a></p>
      </header>
      <section>
        <h3>
          <a id="welcome-to-github-pages" class="anchor" href="#example2"
            aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span>
         </a>Example: Blog comments data
        </h3>
        <p>
          The blog comments data can be found on the <a href =
          "https://archive.ics.uci.edu/ml/datasets/BlogFeedback">UCI
          repository</a>. The original prediction task is for the number of
          comments on a blog over the next 24 hours, but we will tackle the
          simpler task of predicting if there will be <i>any</i> comments over
          the next 24 hours, recasting the problem as a binary classification.
          The main purpose of this example is to demonstrate the use of
          <b>condvis</b> when model <code>predict</code> methods go slightly
          off the beaten track, as happens with the <a href =
          "https://CRAN.R-project.org/package=xgboost">xgboost</a>
          package. We will train an ensemble of 5 boosted tree classifiers, in
          the form of a cross-validated committee, where we only attempt to
          optimise one parameter, the number of boosting iterations -- that is
          <ul>
            <li>randomly split the data into 5 folds</li>
            <li>train 5 models, holding out one of the folds each time for
              validation</li>
            <li>choose the number of boosting iterations for each model which
              minimises the validation loss</li>
          </ul>
        </p>
        <h4>Read in the data</h4>
        <p>
          We can start with the basics and read in the data using <a href
          ="https://CRAN.R-project.org/package=data.table">data.table</a>.
        </p>
        <div class="highlight highlight-source-r">
          <pre>
library(data.table)
train <- fread("data/blogData_train.csv", data.table = FALSE,
  stringsAsFactors = TRUE)
colnames(train)[ncol(train)] <- "comments"</pre>
        </div>
        <p>
          This gives us a dataframe with 52,397 observations on 281 variables.
          The last column is the number of comments, so we name that one for
          clarity. Next, we'll do a bit of tidying and set up our binary target
          (or response).
        </p>
        <div class="highlight highlight-source-r">
          <pre>
## Remove predictors that have only one unique value.
removevars <- which(vapply(train, function(x) length(
  unique(x)), integer(1L)) <= 1)
train <- train[, -removevars]

## Create binary target, and remove 'comments' column.
train$target <- as.integer(train$comments > 0)
train$comments <- NULL</pre>
        </div>
        <h4>Train the ensemble</h4>

        <div class="highlight highlight-source-r">
          <pre>
## Define the parameters we will use for the boosted tree
## classifiers.
classifier.params <- list(booster = "gbtree", objective =
  "binary:logistic", eta = 0.03, gamma = 0.1, max_depth = 6,
  min_child_weight = 1, colsample_bytree = 0.7, eval_metric
  = "logloss")

## Formula to create model matrix.
f <- formula(paste0("~ 0+", paste(setdiff(colnames(train),
  c("comments", "target")), collapse = "+")))

## Function to train an XGBoost model, stopping when further
## iterations increase the loss on the validation set.
trainXGB <- function(params, formula, data, trainindex,
  nrounds = 1500){
  x.train <- xgb.DMatrix(model.matrix(formula, data =
    data[trainindex, ]), label = target[trainindex])
  x.validate <- xgb.DMatrix(model.matrix(formula, data
    = data[-trainindex, ]), label = target[-trainindex])
  suppressWarnings(
    structure(list(model = xgb.train(nrounds = nrounds,
      params = params, data = x.train, watchlist = list(
      "validate" = x.validate, "train" = x.train),
      print.every.n = 20, nthread = 4, early.stop.round =
      200), formula = formula), class = "xgbpred")
  )
}</pre>
        </div>
      <h4>Visualise the ensemble</h4>

      <div class="highlight highlight-source-r">
        <pre>
library("condvis")
library("xgboost")

train$target <- jitter(train$target, amount = 0.05)

ceplot(train, classifiers, "target", varimp$Feature[1],
  varimp$Feature[2:10], xsplotpar = list(xlim = c(0,
  50)), threshold = 0.6)
      </div>
      <iframe src="https://markajoc.shinyapps.io/blog-example/" width = 1100
        height = 650></iframe>
      </section>
      <footer>
        <p>Maintained by <a href="https://github.com/markajoc">Mark O'Connell</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <script src="javascripts/scale.fix.js"></script>

  </body>
</html>
